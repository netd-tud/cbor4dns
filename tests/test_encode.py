import io

import pytest

import cbor2_dns.encode

TEST_VECTOR = (
    pytest.param(
        b"\xd5\xcd\x01\x20\x00\x01\x00\x00\x00\x00\x00\x01\x07\x65\x78\x61"
        b"\x6d\x70\x6c\x65\x03\x6f\x72\x67\x00\x00\x1c\x00\x01\x00\x00\x29"
        b"\x04\xd0\x00\x00\x00\x00\x00\x0c\x00\x0a\x00\x08\x99\x21\x09\x65"
        b"\x33\xa3\x66\xb5",
        id="query example.org AAAA"
    ),
    pytest.param(
        b"\x70\x75\x01\x20\x00\x01\x00\x00\x00\x00\x00\x01\x07\x65\x78\x61"
        b"\x6d\x70\x6c\x65\x03\x6f\x72\x67\x00\x00\x01\x00\x01\x00\x00\x29"
        b"\x04\xd0\x00\x00\x00\x00\x00\x0c\x00\x0a\x00\x08\x74\x5e\x6c\x10"
        b"\xa8\x46\x19\xa4",
        id="query example.org A"
    ),
)


@pytest.mark.parametrize("msg", TEST_VECTOR)
def test_encoder_encode(msg):
    with io.BytesIO() as fp:
        encoder = cbor2_dns.encode.Encoder(fp)
        encoder.encode(msg)
